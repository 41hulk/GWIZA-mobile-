{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.Constants=exports.default=void 0;var _objectSpread2=_interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));var _extends2=_interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));var _regenerator=_interopRequireDefault(require(\"@babel/runtime/regenerator\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _possibleConstructorReturn2=_interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));var _getPrototypeOf2=_interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));var _inherits2=_interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));var _react=_interopRequireDefault(require(\"react\"));var _propTypes=_interopRequireDefault(require(\"prop-types\"));var _lodash=_interopRequireDefault(require(\"lodash.mapvalues\"));var _expoCore=require(\"expo-core\");var _reactNative=require(\"react-native\");var CameraManager=_expoCore.NativeModulesProxy.ExponentCameraManager||_expoCore.NativeModulesProxy.ExponentCameraModule;var EventThrottleMs=500;var _PICTURE_SAVED_CALLBACKS={};var _GLOBAL_PICTURE_ID=1;var Camera=function(_React$Component){(0,_inherits2.default)(Camera,_React$Component);function Camera(props){var _this;(0,_classCallCheck2.default)(this,Camera);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Camera).call(this,props));_this._onCameraReady=function(){if(_this.props.onCameraReady){_this.props.onCameraReady();}};_this._onMountError=function(_ref){var nativeEvent=_ref.nativeEvent;if(_this.props.onMountError){_this.props.onMountError(nativeEvent);}};_this._onPictureSaved=function(_ref2){var nativeEvent=_ref2.nativeEvent;var callback=_PICTURE_SAVED_CALLBACKS[nativeEvent.id];if(callback){callback(nativeEvent.data);delete _PICTURE_SAVED_CALLBACKS[nativeEvent.id];}};_this._onObjectDetected=function(callback){return function(_ref3){var nativeEvent=_ref3.nativeEvent;var type=nativeEvent.type;if(_this._lastEvents[type]&&_this._lastEventsTimes[type]&&JSON.stringify(nativeEvent)===_this._lastEvents[type]&&new Date()-_this._lastEventsTimes[type]<EventThrottleMs){return;}if(callback){callback(nativeEvent);_this._lastEventsTimes[type]=new Date();_this._lastEvents[type]=JSON.stringify(nativeEvent);}};};_this._setReference=function(ref){if(ref){_this._cameraRef=ref;_this._cameraHandle=(0,_reactNative.findNodeHandle)(ref);}else{_this._cameraRef=null;_this._cameraHandle=null;}};_this._onBarCodeScanned=function(){var onBarCodeRead=_this.props.onBarCodeRead&&function(data){console.warn(\"'onBarCodeRead' is deprecated in favour of 'onBarCodeScanned'\");return _this.props.onBarCodeRead(data);};return _this.props.onBarCodeScanned||onBarCodeRead;};_this._lastEvents={};_this._lastEventsTimes={};return _this;}(0,_createClass2.default)(Camera,[{key:\"takePictureAsync\",value:function takePictureAsync(options){var id;return _regenerator.default.async(function takePictureAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!options){options={};}if(!options.quality){options.quality=1;}if(options.onPictureSaved){id=_GLOBAL_PICTURE_ID++;_PICTURE_SAVED_CALLBACKS[id]=options.onPictureSaved;options.id=id;options.fastMode=true;}_context.next=5;return _regenerator.default.awrap(CameraManager.takePicture(options,this._cameraHandle));case 5:return _context.abrupt(\"return\",_context.sent);case 6:case\"end\":return _context.stop();}}},null,this);}},{key:\"getSupportedRatiosAsync\",value:function getSupportedRatiosAsync(){return _regenerator.default.async(function getSupportedRatiosAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(_reactNative.Platform.OS==='android')){_context2.next=6;break;}_context2.next=3;return _regenerator.default.awrap(CameraManager.getSupportedRatios(this._cameraHandle));case 3:return _context2.abrupt(\"return\",_context2.sent);case 6:throw new Error('Ratio is not supported on iOS');case 7:case\"end\":return _context2.stop();}}},null,this);}},{key:\"getAvailablePictureSizesAsync\",value:function getAvailablePictureSizesAsync(ratio){return _regenerator.default.async(function getAvailablePictureSizesAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regenerator.default.awrap(CameraManager.getAvailablePictureSizes(ratio,this._cameraHandle));case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}},null,this);}},{key:\"recordAsync\",value:function recordAsync(options){return _regenerator.default.async(function recordAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!options||typeof options!=='object'){options={};}else if(typeof options.quality==='string'){options.quality=Camera.Constants.VideoQuality[options.quality];}_context4.next=3;return _regenerator.default.awrap(CameraManager.record(options,this._cameraHandle));case 3:return _context4.abrupt(\"return\",_context4.sent);case 4:case\"end\":return _context4.stop();}}},null,this);}},{key:\"stopRecording\",value:function stopRecording(){CameraManager.stopRecording(this._cameraHandle);}},{key:\"pausePreview\",value:function pausePreview(){CameraManager.pausePreview(this._cameraHandle);}},{key:\"resumePreview\",value:function resumePreview(){CameraManager.resumePreview(this._cameraHandle);}},{key:\"render\",value:function render(){var nativeProps=this._convertNativeProps(this.props);return _react.default.createElement(ExponentCamera,(0,_extends2.default)({},nativeProps,{ref:this._setReference,onCameraReady:this._onCameraReady,onMountError:this._onMountError,onPictureSaved:this._onPictureSaved,onBarCodeScanned:this._onObjectDetected(this._onBarCodeScanned()),onFacesDetected:this._onObjectDetected(this.props.onFacesDetected)}));}},{key:\"_convertNativeProps\",value:function _convertNativeProps(props){var newProps=(0,_lodash.default)(props,this._convertProp);var propsKeys=Object.keys(newProps);if(!propsKeys.includes(\"barCodeScannerSettings\")&&propsKeys.includes(\"barCodeTypes\")){newProps.barCodeScannerSettings={barCodeTypes:newProps.barCodeTypes};}if(props.onBarCodeScanned||props.onBarCodeRead){newProps.barCodeScannerEnabled=true;}if(props.onFacesDetected){newProps.faceDetectorEnabled=true;}if(_reactNative.Platform.OS==='ios'){delete newProps.ratio;delete newProps.useCamera2Api;}return newProps;}},{key:\"_convertProp\",value:function _convertProp(value,key){if(typeof value==='string'&&Camera.ConversionTables[key]){return Camera.ConversionTables[key][value];}return value;}}]);return Camera;}(_react.default.Component);exports.default=Camera;Camera.Constants={Type:CameraManager.Type,FlashMode:CameraManager.FlashMode,AutoFocus:CameraManager.AutoFocus,WhiteBalance:CameraManager.WhiteBalance,VideoQuality:CameraManager.VideoQuality,VideoStabilization:CameraManager.VideoStabilization||{}};Camera.ConversionTables={type:CameraManager.Type,flashMode:CameraManager.FlashMode,autoFocus:CameraManager.AutoFocus,whiteBalance:CameraManager.WhiteBalance};Camera.propTypes=(0,_objectSpread2.default)({},_reactNative.ViewPropTypes,{zoom:_propTypes.default.number,ratio:_propTypes.default.string,focusDepth:_propTypes.default.number,onMountError:_propTypes.default.func,pictureSize:_propTypes.default.string,onCameraReady:_propTypes.default.func,useCamera2Api:_propTypes.default.bool,onBarCodeScanned:_propTypes.default.func,barCodeScannerSettings:_propTypes.default.object,onFacesDetected:_propTypes.default.func,faceDetectorSettings:_propTypes.default.object,type:_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.number]),flashMode:_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.number]),videoStabilizationMode:_propTypes.default.number,whiteBalance:_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.number]),autoFocus:_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.number,_propTypes.default.bool])});Camera.defaultProps={zoom:0,ratio:'4:3',focusDepth:0,faceDetectorSettings:{},type:CameraManager.Type.back,autoFocus:CameraManager.AutoFocus.on,flashMode:CameraManager.FlashMode.off,whiteBalance:CameraManager.WhiteBalance.auto};var Constants=Camera.Constants;exports.Constants=Constants;var ExponentCamera=(0,_expoCore.requireNativeViewManager)('ExponentCamera',Camera);","map":{"version":3,"sources":["/Users/ntareguy/Downloads/gwizamobile1/node_modules/expo-camera/src/Camera.js"],"names":["CameraManager","NativeModulesProxy","ExponentCameraManager","ExponentCameraModule","EventThrottleMs","_PICTURE_SAVED_CALLBACKS","_GLOBAL_PICTURE_ID","Camera","props","_onCameraReady","onCameraReady","_onMountError","nativeEvent","onMountError","_onPictureSaved","callback","id","data","_onObjectDetected","type","_lastEvents","_lastEventsTimes","JSON","stringify","Date","_setReference","ref","_cameraRef","_cameraHandle","_onBarCodeScanned","onBarCodeRead","console","warn","onBarCodeScanned","options","quality","onPictureSaved","fastMode","takePicture","Platform","OS","getSupportedRatios","Error","ratio","getAvailablePictureSizes","Constants","VideoQuality","record","stopRecording","pausePreview","resumePreview","nativeProps","_convertNativeProps","onFacesDetected","newProps","_convertProp","propsKeys","Object","keys","includes","barCodeScannerSettings","barCodeTypes","barCodeScannerEnabled","faceDetectorEnabled","useCamera2Api","value","key","ConversionTables","React","Component","Type","FlashMode","AutoFocus","WhiteBalance","VideoStabilization","flashMode","autoFocus","whiteBalance","propTypes","ViewPropTypes","zoom","PropTypes","number","string","focusDepth","func","pictureSize","bool","object","faceDetectorSettings","oneOfType","videoStabilizationMode","defaultProps","back","on","off","auto","ExponentCamera"],"mappings":"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","sourcesContent":["// @flow\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport mapValues from 'lodash.mapvalues';\nimport { NativeModulesProxy, requireNativeViewManager } from 'expo-core';\nimport { findNodeHandle, ViewPropTypes, Platform } from 'react-native';\n\ntype PictureOptions = {\n  quality?: number,\n  base64?: boolean,\n  exif?: boolean,\n  skipProcessing?: boolean,\n  onPictureSaved?: Function,\n  // internal\n  id?: number,\n  fastMode?: boolean,\n};\n\ntype RecordingOptions = {\n  maxDuration?: number,\n  maxFileSize?: number,\n  quality?: number | string,\n};\n\ntype CapturedPicture = {\n  width: number,\n  height: number,\n  uri: string,\n  base64?: string,\n  exif?: Object,\n};\n\ntype RecordingResult = {\n  uri: string,\n};\n\ntype EventCallbackArgumentsType = {\n  nativeEvent: Object,\n};\n\ntype MountErrorNativeEventType = {\n  message: string,\n};\n\ntype PictureSavedNativeEventType = {\n  data: CapturedPicture,\n  id: number,\n};\n\ntype PropsType = ViewPropTypes & {\n  zoom?: number,\n  ratio?: string,\n  focusDepth?: number,\n  type?: number | string,\n  onCameraReady?: Function,\n  useCamera2Api?: boolean,\n  flashMode?: number | string,\n  whiteBalance?: number | string,\n  autoFocus?: string | boolean | number,\n  pictureSize?: string,\n  videoStabilizationMode?: number,\n  onMountError?: MountErrorNativeEventType => void,\n  barCodeScannerSettings?: {},\n  onBarCodeScanned?: ({ type: string, data: string }) => void,\n  faceDetectorSettings?: {},\n  onFacesDetected?: ({ faces: Array<*> }) => void,\n};\n\nconst CameraManager: Object =\n  NativeModulesProxy.ExponentCameraManager || NativeModulesProxy.ExponentCameraModule;\n\nconst EventThrottleMs = 500;\n\nconst _PICTURE_SAVED_CALLBACKS = {};\nlet _GLOBAL_PICTURE_ID = 1;\n\nexport default class Camera extends React.Component<PropsType> {\n  static Constants = {\n    Type: CameraManager.Type,\n    FlashMode: CameraManager.FlashMode,\n    AutoFocus: CameraManager.AutoFocus,\n    WhiteBalance: CameraManager.WhiteBalance,\n    VideoQuality: CameraManager.VideoQuality,\n    VideoStabilization: CameraManager.VideoStabilization || {}\n\n  };\n\n  // Values under keys from this object will be transformed to native options\n  static ConversionTables = {\n    type: CameraManager.Type,\n    flashMode: CameraManager.FlashMode,\n    autoFocus: CameraManager.AutoFocus,\n    whiteBalance: CameraManager.WhiteBalance,\n  };\n\n  static propTypes = {\n    ...ViewPropTypes,\n    zoom: PropTypes.number,\n    ratio: PropTypes.string,\n    focusDepth: PropTypes.number,\n    onMountError: PropTypes.func,\n    pictureSize: PropTypes.string,\n    onCameraReady: PropTypes.func,\n    useCamera2Api: PropTypes.bool,\n    onBarCodeScanned: PropTypes.func,\n    barCodeScannerSettings: PropTypes.object,\n    onFacesDetected: PropTypes.func,\n    faceDetectorSettings: PropTypes.object,\n    type: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    flashMode: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    videoStabilizationMode: PropTypes.number,\n    whiteBalance: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    autoFocus: PropTypes.oneOfType([PropTypes.string, PropTypes.number, PropTypes.bool]),\n  };\n\n  static defaultProps: Object = {\n    zoom: 0,\n    ratio: '4:3',\n    focusDepth: 0,\n    faceDetectorSettings: {},\n    type: CameraManager.Type.back,\n    autoFocus: CameraManager.AutoFocus.on,\n    flashMode: CameraManager.FlashMode.off,\n    whiteBalance: CameraManager.WhiteBalance.auto,\n  };\n\n  _cameraRef: ?Object;\n  _cameraHandle: ?number;\n  _lastEvents: { [string]: string };\n  _lastEventsTimes: { [string]: Date };\n\n  constructor(props: PropsType) {\n    super(props);\n    this._lastEvents = {};\n    this._lastEventsTimes = {};\n  }\n\n  async takePictureAsync(options?: PictureOptions): Promise<CapturedPicture> {\n    if (!options) {\n      options = {};\n    }\n    if (!options.quality) {\n      options.quality = 1;\n    }\n    if (options.onPictureSaved) {\n      const id = _GLOBAL_PICTURE_ID++;\n      _PICTURE_SAVED_CALLBACKS[id] = options.onPictureSaved;\n      options.id = id;\n      options.fastMode = true;\n    }\n    return await CameraManager.takePicture(options, this._cameraHandle);\n  }\n\n  async getSupportedRatiosAsync(): Promise<Array<string>> {\n    if (Platform.OS === 'android') {\n      return await CameraManager.getSupportedRatios(this._cameraHandle);\n    } else {\n      throw new Error('Ratio is not supported on iOS');\n    }\n  }\n\n  async getAvailablePictureSizesAsync(ratio?: string): Promise<Array<string>> {\n    return await CameraManager.getAvailablePictureSizes(ratio, this._cameraHandle);\n  }\n\n  async recordAsync(options?: RecordingOptions): Promise<RecordingResult> {\n    if (!options || typeof options !== 'object') {\n      options = {};\n    } else if (typeof options.quality === 'string') {\n      options.quality = Camera.Constants.VideoQuality[options.quality];\n    }\n    return await CameraManager.record(options, this._cameraHandle);\n  }\n\n  stopRecording() {\n    CameraManager.stopRecording(this._cameraHandle);\n  }\n\n  pausePreview() {\n    CameraManager.pausePreview(this._cameraHandle);\n  }\n\n  resumePreview() {\n    CameraManager.resumePreview(this._cameraHandle);\n  }\n\n  _onCameraReady = () => {\n    if (this.props.onCameraReady) {\n      this.props.onCameraReady();\n    }\n  };\n\n  _onMountError = ({ nativeEvent }: { nativeEvent: MountErrorNativeEventType }) => {\n    if (this.props.onMountError) {\n      this.props.onMountError(nativeEvent);\n    }\n  };\n\n  _onPictureSaved = ({ nativeEvent }: { nativeEvent: PictureSavedNativeEventType }) => {\n    const callback = _PICTURE_SAVED_CALLBACKS[nativeEvent.id];\n    if (callback) {\n      callback(nativeEvent.data);\n      delete _PICTURE_SAVED_CALLBACKS[nativeEvent.id];\n    }\n  };\n\n  _onObjectDetected = (callback: ?Function) => ({ nativeEvent }: EventCallbackArgumentsType) => {\n    const { type } = nativeEvent;\n    if (\n      this._lastEvents[type] &&\n      this._lastEventsTimes[type] &&\n      JSON.stringify(nativeEvent) === this._lastEvents[type] &&\n      new Date() - this._lastEventsTimes[type] < EventThrottleMs\n    ) {\n      return;\n    }\n\n    if (callback) {\n      callback(nativeEvent);\n      this._lastEventsTimes[type] = new Date();\n      this._lastEvents[type] = JSON.stringify(nativeEvent);\n    }\n  };\n\n  _setReference = (ref: ?Object) => {\n    if (ref) {\n      this._cameraRef = ref;\n      this._cameraHandle = findNodeHandle(ref);\n    } else {\n      this._cameraRef = null;\n      this._cameraHandle = null;\n    }\n  };\n\n  _onBarCodeScanned = () => {\n    const onBarCodeRead = this.props.onBarCodeRead && ((data) => {\n      console.warn(\"'onBarCodeRead' is deprecated in favour of 'onBarCodeScanned'\");\n      return this.props.onBarCodeRead(data);\n    });\n    return this.props.onBarCodeScanned || onBarCodeRead;\n  };\n\n  render() {\n    const nativeProps = this._convertNativeProps(this.props);\n\n    return (\n      <ExponentCamera\n        {...nativeProps}\n        ref={this._setReference}\n        onCameraReady={this._onCameraReady}\n        onMountError={this._onMountError}\n        onPictureSaved={this._onPictureSaved}\n        onBarCodeScanned={this._onObjectDetected(this._onBarCodeScanned())}\n        onFacesDetected={this._onObjectDetected(this.props.onFacesDetected)}\n      />\n    );\n  }\n\n  _convertNativeProps(props: PropsType) {\n    const newProps = mapValues(props, this._convertProp);\n\n    const propsKeys = Object.keys(newProps);\n    if (!propsKeys.includes(\"barCodeScannerSettings\") && propsKeys.includes(\"barCodeTypes\")) { // barCodeTypes is deprecated\n      newProps.barCodeScannerSettings = {\n        barCodeTypes: newProps.barCodeTypes,\n      };\n    }\n\n    if (props.onBarCodeScanned || props.onBarCodeRead) { // onBarCodeRead is deprecated\n      newProps.barCodeScannerEnabled = true;\n    }\n\n    if (props.onFacesDetected) {\n      newProps.faceDetectorEnabled = true;\n    }\n\n    if (Platform.OS === 'ios') {\n      delete newProps.ratio;\n      delete newProps.useCamera2Api;\n    }\n\n    return newProps;\n  }\n\n  _convertProp(value: *, key: string): * {\n    if (typeof value === 'string' && Camera.ConversionTables[key]) {\n      return Camera.ConversionTables[key][value];\n    }\n\n    return value;\n  }\n}\n\nexport const Constants = Camera.Constants;\n\nconst ExponentCamera = requireNativeViewManager('ExponentCamera', Camera);\n"]},"metadata":{},"sourceType":"script"}