{"ast":null,"code":"'use strict';var _toConsumableArray=require(\"@babel/runtime/helpers/toConsumableArray\");var _classCallCheck=require(\"@babel/runtime/helpers/classCallCheck\");var _createClass=require(\"@babel/runtime/helpers/createClass\");var ErrorUtils=require(\"../vendor/core/ErrorUtils\");var Systrace=require(\"../Performance/Systrace\");var deepFreezeAndThrowOnMutationInDev=require(\"../Utilities/deepFreezeAndThrowOnMutationInDev\");var invariant=require('fbjs/lib/invariant');var stringifySafe=require(\"../Utilities/stringifySafe\");var TO_JS=0;var TO_NATIVE=1;var MODULE_IDS=0;var METHOD_IDS=1;var PARAMS=2;var MIN_TIME_BETWEEN_FLUSHES_MS=5;var TRACE_TAG_REACT_APPS=1<<17;var DEBUG_INFO_LIMIT=32;var MessageQueue=function(){function MessageQueue(){_classCallCheck(this,MessageQueue);this._lazyCallableModules={};this._queue=[[],[],[],0];this._successCallbacks={};this._failureCallbacks={};this._callID=0;this._lastFlush=0;this._eventLoopStartTime=new Date().getTime();this._immediatesCallback=null;if(__DEV__){this._debugInfo={};this._remoteModuleTable={};this._remoteMethodTable={};}this.callFunctionReturnFlushedQueue=this.callFunctionReturnFlushedQueue.bind(this);this.callFunctionReturnResultAndFlushedQueue=this.callFunctionReturnResultAndFlushedQueue.bind(this);this.flushedQueue=this.flushedQueue.bind(this);this.invokeCallbackAndReturnFlushedQueue=this.invokeCallbackAndReturnFlushedQueue.bind(this);}_createClass(MessageQueue,[{key:\"callFunctionReturnFlushedQueue\",value:function callFunctionReturnFlushedQueue(module,method,args){var _this=this;this.__guard(function(){_this.__callFunction(module,method,args);});return this.flushedQueue();}},{key:\"callFunctionReturnResultAndFlushedQueue\",value:function callFunctionReturnResultAndFlushedQueue(module,method,args){var _this2=this;var result;this.__guard(function(){result=_this2.__callFunction(module,method,args);});return[result,this.flushedQueue()];}},{key:\"invokeCallbackAndReturnFlushedQueue\",value:function invokeCallbackAndReturnFlushedQueue(cbID,args){var _this3=this;this.__guard(function(){_this3.__invokeCallback(cbID,args);});return this.flushedQueue();}},{key:\"flushedQueue\",value:function flushedQueue(){var _this4=this;this.__guard(function(){_this4.__callImmediates();});var queue=this._queue;this._queue=[[],[],[],this._callID];return queue[0].length?queue:null;}},{key:\"getEventLoopRunningTime\",value:function getEventLoopRunningTime(){return new Date().getTime()-this._eventLoopStartTime;}},{key:\"registerCallableModule\",value:function registerCallableModule(name,module){this._lazyCallableModules[name]=function(){return module;};}},{key:\"registerLazyCallableModule\",value:function registerLazyCallableModule(name,factory){var module;var getValue=factory;this._lazyCallableModules[name]=function(){if(getValue){module=getValue();getValue=null;}return module;};}},{key:\"getCallableModule\",value:function getCallableModule(name){var getValue=this._lazyCallableModules[name];return getValue?getValue():null;}},{key:\"enqueueNativeCall\",value:function enqueueNativeCall(moduleID,methodID,params,onFail,onSucc){if(onFail||onSucc){if(__DEV__){this._debugInfo[this._callID]=[moduleID,methodID];if(this._callID>DEBUG_INFO_LIMIT){delete this._debugInfo[this._callID-DEBUG_INFO_LIMIT];}}onFail&&params.push(this._callID<<1);onSucc&&params.push(this._callID<<1|1);this._successCallbacks[this._callID]=onSucc;this._failureCallbacks[this._callID]=onFail;}if(__DEV__){global.nativeTraceBeginAsyncFlow&&global.nativeTraceBeginAsyncFlow(TRACE_TAG_REACT_APPS,'native',this._callID);}this._callID++;this._queue[MODULE_IDS].push(moduleID);this._queue[METHOD_IDS].push(methodID);if(__DEV__){var isValidArgument=function isValidArgument(val){var t=typeof val;if(t==='undefined'||t==='null'||t==='boolean'||t==='number'||t==='string'){return true;}if(t==='function'||t!=='object'){return false;}if(Array.isArray(val)){return val.every(isValidArgument);}for(var k in val){if(typeof val[k]!=='function'&&!isValidArgument(val[k])){return false;}}return true;};invariant(isValidArgument(params),'%s is not usable as a native method argument',params);deepFreezeAndThrowOnMutationInDev(params);}this._queue[PARAMS].push(params);var now=new Date().getTime();if(global.nativeFlushQueueImmediate&&now-this._lastFlush>=MIN_TIME_BETWEEN_FLUSHES_MS){var queue=this._queue;this._queue=[[],[],[],this._callID];this._lastFlush=now;global.nativeFlushQueueImmediate(queue);}Systrace.counterEvent('pending_js_to_native_queue',this._queue[0].length);if(__DEV__&&this.__spy&&isFinite(moduleID)){this.__spy({type:TO_NATIVE,module:this._remoteModuleTable[moduleID],method:this._remoteMethodTable[moduleID][methodID],args:params});}else if(this.__spy){this.__spy({type:TO_NATIVE,module:moduleID+'',method:methodID,args:params});}}},{key:\"createDebugLookup\",value:function createDebugLookup(moduleID,name,methods){if(__DEV__){this._remoteModuleTable[moduleID]=name;this._remoteMethodTable[moduleID]=methods;}}},{key:\"setImmediatesCallback\",value:function setImmediatesCallback(fn){this._immediatesCallback=fn;}},{key:\"__guard\",value:function __guard(fn){if(this.__shouldPauseOnThrow()){fn();}else{try{fn();}catch(error){ErrorUtils.reportFatalError(error);}}}},{key:\"__shouldPauseOnThrow\",value:function __shouldPauseOnThrow(){return typeof DebuggerInternal!=='undefined'&&DebuggerInternal.shouldPauseOnThrow===true;}},{key:\"__callImmediates\",value:function __callImmediates(){Systrace.beginEvent('JSTimers.callImmediates()');if(this._immediatesCallback!=null){this._immediatesCallback();}Systrace.endEvent();}},{key:\"__callFunction\",value:function __callFunction(module,method,args){this._lastFlush=new Date().getTime();this._eventLoopStartTime=this._lastFlush;if(__DEV__||this.__spy){Systrace.beginEvent(module+\".\"+method+\"(\"+stringifySafe(args)+\")\");}else{Systrace.beginEvent(module+\".\"+method+\"(...)\");}if(this.__spy){this.__spy({type:TO_JS,module:module,method:method,args:args});}var moduleMethods=this.getCallableModule(module);invariant(!!moduleMethods,'Module %s is not a registered callable module (calling %s)',module,method);invariant(!!moduleMethods[method],'Method %s does not exist on module %s',method,module);var result=moduleMethods[method].apply(moduleMethods,args);Systrace.endEvent();return result;}},{key:\"__invokeCallback\",value:function __invokeCallback(cbID,args){this._lastFlush=new Date().getTime();this._eventLoopStartTime=this._lastFlush;var callID=cbID>>>1;var isSuccess=cbID&1;var callback=isSuccess?this._successCallbacks[callID]:this._failureCallbacks[callID];if(__DEV__){var debug=this._debugInfo[callID];var _module=debug&&this._remoteModuleTable[debug[0]];var method=debug&&this._remoteMethodTable[debug[0]][debug[1]];if(!callback){var errorMessage=\"Callback with id \"+cbID+\": \"+_module+\".\"+method+\"() not found\";if(method){errorMessage=\"The callback \"+method+\"() exists in module \"+_module+\", \"+'but only one callback may be registered to a function in a native module.';}invariant(callback,errorMessage);}var profileName=debug?'<callback for '+_module+'.'+method+'>':cbID;if(callback&&this.__spy){this.__spy({type:TO_JS,module:null,method:profileName,args:args});}Systrace.beginEvent(\"MessageQueue.invokeCallback(\"+profileName+\", \"+stringifySafe(args)+\")\");}if(!callback){return;}delete this._successCallbacks[callID];delete this._failureCallbacks[callID];callback.apply(void 0,_toConsumableArray(args));if(__DEV__){Systrace.endEvent();}}}],[{key:\"spy\",value:function spy(spyOrToggle){if(spyOrToggle===true){MessageQueue.prototype.__spy=function(info){console.log((info.type===TO_JS?'N->JS':'JS->N')+\" : \"+(\"\"+(info.module?info.module+'.':'')+info.method)+(\"(\"+JSON.stringify(info.args)+\")\"));};}else if(spyOrToggle===false){MessageQueue.prototype.__spy=null;}else{MessageQueue.prototype.__spy=spyOrToggle;}}}]);return MessageQueue;}();module.exports=MessageQueue;","map":{"version":3,"sources":["/Users/ntareguy/Downloads/gwizamobile1/node_modules/react-native/Libraries/BatchedBridge/MessageQueue.js"],"names":["ErrorUtils","require","Systrace","deepFreezeAndThrowOnMutationInDev","invariant","stringifySafe","TO_JS","TO_NATIVE","MODULE_IDS","METHOD_IDS","PARAMS","MIN_TIME_BETWEEN_FLUSHES_MS","TRACE_TAG_REACT_APPS","DEBUG_INFO_LIMIT","MessageQueue","_lazyCallableModules","_queue","_successCallbacks","_failureCallbacks","_callID","_lastFlush","_eventLoopStartTime","Date","getTime","_immediatesCallback","__DEV__","_debugInfo","_remoteModuleTable","_remoteMethodTable","callFunctionReturnFlushedQueue","bind","callFunctionReturnResultAndFlushedQueue","flushedQueue","invokeCallbackAndReturnFlushedQueue","module","method","args","__guard","__callFunction","result","cbID","__invokeCallback","__callImmediates","queue","length","name","factory","getValue","moduleID","methodID","params","onFail","onSucc","push","global","nativeTraceBeginAsyncFlow","isValidArgument","val","t","Array","isArray","every","k","now","nativeFlushQueueImmediate","counterEvent","__spy","isFinite","type","methods","fn","__shouldPauseOnThrow","error","reportFatalError","DebuggerInternal","shouldPauseOnThrow","beginEvent","endEvent","moduleMethods","getCallableModule","apply","callID","isSuccess","callback","debug","errorMessage","profileName","spyOrToggle","prototype","info","console","log","JSON","stringify","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2015-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n * @format\n */\n\n'use strict';\n\nconst ErrorUtils = require('../vendor/core/ErrorUtils');\nconst Systrace = require('../Performance/Systrace');\n\nconst deepFreezeAndThrowOnMutationInDev = require('../Utilities/deepFreezeAndThrowOnMutationInDev');\nconst invariant = require('fbjs/lib/invariant');\nconst stringifySafe = require('../Utilities/stringifySafe');\n\nexport type SpyData = {\n  type: number,\n  module: ?string,\n  method: string | number,\n  args: any[],\n};\n\nconst TO_JS = 0;\nconst TO_NATIVE = 1;\n\nconst MODULE_IDS = 0;\nconst METHOD_IDS = 1;\nconst PARAMS = 2;\nconst MIN_TIME_BETWEEN_FLUSHES_MS = 5;\n\n// eslint-disable-next-line no-bitwise\nconst TRACE_TAG_REACT_APPS = 1 << 17;\n\nconst DEBUG_INFO_LIMIT = 32;\n\nclass MessageQueue {\n  _lazyCallableModules: {[key: string]: (void) => Object};\n  _queue: [number[], number[], any[], number];\n  _successCallbacks: {[key: number]: ?Function};\n  _failureCallbacks: {[key: number]: ?Function};\n  _callID: number;\n  _lastFlush: number;\n  _eventLoopStartTime: number;\n  _immediatesCallback: ?() => void;\n\n  _debugInfo: {[number]: [number, number]};\n  _remoteModuleTable: {[number]: string};\n  _remoteMethodTable: {[number]: string[]};\n\n  __spy: ?(data: SpyData) => void;\n\n  constructor() {\n    this._lazyCallableModules = {};\n    this._queue = [[], [], [], 0];\n    this._successCallbacks = {};\n    this._failureCallbacks = {};\n    this._callID = 0;\n    this._lastFlush = 0;\n    this._eventLoopStartTime = new Date().getTime();\n    this._immediatesCallback = null;\n\n    if (__DEV__) {\n      this._debugInfo = {};\n      this._remoteModuleTable = {};\n      this._remoteMethodTable = {};\n    }\n\n    (this: any).callFunctionReturnFlushedQueue = this.callFunctionReturnFlushedQueue.bind(\n      this,\n    );\n    (this: any).callFunctionReturnResultAndFlushedQueue = this.callFunctionReturnResultAndFlushedQueue.bind(\n      this,\n    );\n    (this: any).flushedQueue = this.flushedQueue.bind(this);\n    (this: any).invokeCallbackAndReturnFlushedQueue = this.invokeCallbackAndReturnFlushedQueue.bind(\n      this,\n    );\n  }\n\n  /**\n   * Public APIs\n   */\n\n  static spy(spyOrToggle: boolean | ((data: SpyData) => void)) {\n    if (spyOrToggle === true) {\n      MessageQueue.prototype.__spy = info => {\n        console.log(\n          `${info.type === TO_JS ? 'N->JS' : 'JS->N'} : ` +\n            `${info.module ? info.module + '.' : ''}${info.method}` +\n            `(${JSON.stringify(info.args)})`,\n        );\n      };\n    } else if (spyOrToggle === false) {\n      MessageQueue.prototype.__spy = null;\n    } else {\n      MessageQueue.prototype.__spy = spyOrToggle;\n    }\n  }\n\n  callFunctionReturnFlushedQueue(module: string, method: string, args: any[]) {\n    this.__guard(() => {\n      this.__callFunction(module, method, args);\n    });\n\n    return this.flushedQueue();\n  }\n\n  callFunctionReturnResultAndFlushedQueue(\n    module: string,\n    method: string,\n    args: any[],\n  ) {\n    let result;\n    this.__guard(() => {\n      result = this.__callFunction(module, method, args);\n    });\n\n    return [result, this.flushedQueue()];\n  }\n\n  invokeCallbackAndReturnFlushedQueue(cbID: number, args: any[]) {\n    this.__guard(() => {\n      this.__invokeCallback(cbID, args);\n    });\n\n    return this.flushedQueue();\n  }\n\n  flushedQueue() {\n    this.__guard(() => {\n      this.__callImmediates();\n    });\n\n    const queue = this._queue;\n    this._queue = [[], [], [], this._callID];\n    return queue[0].length ? queue : null;\n  }\n\n  getEventLoopRunningTime() {\n    return new Date().getTime() - this._eventLoopStartTime;\n  }\n\n  registerCallableModule(name: string, module: Object) {\n    this._lazyCallableModules[name] = () => module;\n  }\n\n  registerLazyCallableModule(name: string, factory: void => Object) {\n    let module: Object;\n    let getValue: ?(void) => Object = factory;\n    this._lazyCallableModules[name] = () => {\n      if (getValue) {\n        module = getValue();\n        getValue = null;\n      }\n      return module;\n    };\n  }\n\n  getCallableModule(name: string) {\n    const getValue = this._lazyCallableModules[name];\n    return getValue ? getValue() : null;\n  }\n\n  enqueueNativeCall(\n    moduleID: number,\n    methodID: number,\n    params: any[],\n    onFail: ?Function,\n    onSucc: ?Function,\n  ) {\n    if (onFail || onSucc) {\n      if (__DEV__) {\n        this._debugInfo[this._callID] = [moduleID, methodID];\n        if (this._callID > DEBUG_INFO_LIMIT) {\n          delete this._debugInfo[this._callID - DEBUG_INFO_LIMIT];\n        }\n      }\n      // Encode callIDs into pairs of callback identifiers by shifting left and using the rightmost bit\n      // to indicate fail (0) or success (1)\n      // eslint-disable-next-line no-bitwise\n      onFail && params.push(this._callID << 1);\n      // eslint-disable-next-line no-bitwise\n      onSucc && params.push((this._callID << 1) | 1);\n      this._successCallbacks[this._callID] = onSucc;\n      this._failureCallbacks[this._callID] = onFail;\n    }\n\n    if (__DEV__) {\n      global.nativeTraceBeginAsyncFlow &&\n        global.nativeTraceBeginAsyncFlow(\n          TRACE_TAG_REACT_APPS,\n          'native',\n          this._callID,\n        );\n    }\n    this._callID++;\n\n    this._queue[MODULE_IDS].push(moduleID);\n    this._queue[METHOD_IDS].push(methodID);\n\n    if (__DEV__) {\n      // Validate that parameters passed over the bridge are\n      // folly-convertible.  As a special case, if a prop value is a\n      // function it is permitted here, and special-cased in the\n      // conversion.\n      const isValidArgument = val => {\n        const t = typeof val;\n        if (\n          t === 'undefined' ||\n          t === 'null' ||\n          t === 'boolean' ||\n          t === 'number' ||\n          t === 'string'\n        ) {\n          return true;\n        }\n        if (t === 'function' || t !== 'object') {\n          return false;\n        }\n        if (Array.isArray(val)) {\n          return val.every(isValidArgument);\n        }\n        for (const k in val) {\n          if (typeof val[k] !== 'function' && !isValidArgument(val[k])) {\n            return false;\n          }\n        }\n        return true;\n      };\n\n      invariant(\n        isValidArgument(params),\n        '%s is not usable as a native method argument',\n        params,\n      );\n\n      // The params object should not be mutated after being queued\n      deepFreezeAndThrowOnMutationInDev((params: any));\n    }\n    this._queue[PARAMS].push(params);\n\n    const now = new Date().getTime();\n    if (\n      global.nativeFlushQueueImmediate &&\n      now - this._lastFlush >= MIN_TIME_BETWEEN_FLUSHES_MS\n    ) {\n      const queue = this._queue;\n      this._queue = [[], [], [], this._callID];\n      this._lastFlush = now;\n      global.nativeFlushQueueImmediate(queue);\n    }\n    Systrace.counterEvent('pending_js_to_native_queue', this._queue[0].length);\n    if (__DEV__ && this.__spy && isFinite(moduleID)) {\n      this.__spy({\n        type: TO_NATIVE,\n        module: this._remoteModuleTable[moduleID],\n        method: this._remoteMethodTable[moduleID][methodID],\n        args: params,\n      });\n    } else if (this.__spy) {\n      this.__spy({\n        type: TO_NATIVE,\n        module: moduleID + '',\n        method: methodID,\n        args: params,\n      });\n    }\n  }\n\n  createDebugLookup(moduleID: number, name: string, methods: string[]) {\n    if (__DEV__) {\n      this._remoteModuleTable[moduleID] = name;\n      this._remoteMethodTable[moduleID] = methods;\n    }\n  }\n\n  // For JSTimers to register its callback. Otherwise a circular dependency\n  // between modules is introduced. Note that only one callback may be\n  // registered at a time.\n  setImmediatesCallback(fn: () => void) {\n    this._immediatesCallback = fn;\n  }\n\n  /**\n   * Private methods\n   */\n\n  __guard(fn: () => void) {\n    if (this.__shouldPauseOnThrow()) {\n      fn();\n    } else {\n      try {\n        fn();\n      } catch (error) {\n        ErrorUtils.reportFatalError(error);\n      }\n    }\n  }\n\n  // MessageQueue installs a global handler to catch all exceptions where JS users can register their own behavior\n  // This handler makes all exceptions to be propagated from inside MessageQueue rather than by the VM at their origin\n  // This makes stacktraces to be placed at MessageQueue rather than at where they were launched\n  // The parameter DebuggerInternal.shouldPauseOnThrow is used to check before catching all exceptions and\n  // can be configured by the VM or any Inspector\n  __shouldPauseOnThrow() {\n    return (\n      // $FlowFixMe\n      typeof DebuggerInternal !== 'undefined' &&\n      DebuggerInternal.shouldPauseOnThrow === true // eslint-disable-line no-undef\n    );\n  }\n\n  __callImmediates() {\n    Systrace.beginEvent('JSTimers.callImmediates()');\n    if (this._immediatesCallback != null) {\n      this._immediatesCallback();\n    }\n    Systrace.endEvent();\n  }\n\n  __callFunction(module: string, method: string, args: any[]): any {\n    this._lastFlush = new Date().getTime();\n    this._eventLoopStartTime = this._lastFlush;\n    if (__DEV__ || this.__spy) {\n      Systrace.beginEvent(`${module}.${method}(${stringifySafe(args)})`);\n    } else {\n      Systrace.beginEvent(`${module}.${method}(...)`);\n    }\n    if (this.__spy) {\n      this.__spy({type: TO_JS, module, method, args});\n    }\n    const moduleMethods = this.getCallableModule(module);\n    invariant(\n      !!moduleMethods,\n      'Module %s is not a registered callable module (calling %s)',\n      module,\n      method,\n    );\n    invariant(\n      !!moduleMethods[method],\n      'Method %s does not exist on module %s',\n      method,\n      module,\n    );\n    const result = moduleMethods[method].apply(moduleMethods, args);\n    Systrace.endEvent();\n    return result;\n  }\n\n  __invokeCallback(cbID: number, args: any[]) {\n    this._lastFlush = new Date().getTime();\n    this._eventLoopStartTime = this._lastFlush;\n\n    // The rightmost bit of cbID indicates fail (0) or success (1), the other bits are the callID shifted left.\n    // eslint-disable-next-line no-bitwise\n    const callID = cbID >>> 1;\n    // eslint-disable-next-line no-bitwise\n    const isSuccess = cbID & 1;\n    const callback = isSuccess\n      ? this._successCallbacks[callID]\n      : this._failureCallbacks[callID];\n\n    if (__DEV__) {\n      const debug = this._debugInfo[callID];\n      const module = debug && this._remoteModuleTable[debug[0]];\n      const method = debug && this._remoteMethodTable[debug[0]][debug[1]];\n      if (!callback) {\n        let errorMessage = `Callback with id ${cbID}: ${module}.${method}() not found`;\n        if (method) {\n          errorMessage =\n            `The callback ${method}() exists in module ${module}, ` +\n            'but only one callback may be registered to a function in a native module.';\n        }\n        invariant(callback, errorMessage);\n      }\n      const profileName = debug\n        ? '<callback for ' + module + '.' + method + '>'\n        : cbID;\n      if (callback && this.__spy) {\n        this.__spy({type: TO_JS, module: null, method: profileName, args});\n      }\n      Systrace.beginEvent(\n        `MessageQueue.invokeCallback(${profileName}, ${stringifySafe(args)})`,\n      );\n    }\n\n    if (!callback) {\n      return;\n    }\n\n    delete this._successCallbacks[callID];\n    delete this._failureCallbacks[callID];\n    callback(...args);\n\n    if (__DEV__) {\n      Systrace.endEvent();\n    }\n  }\n}\n\nmodule.exports = MessageQueue;\n"]},"metadata":{},"sourceType":"script"}