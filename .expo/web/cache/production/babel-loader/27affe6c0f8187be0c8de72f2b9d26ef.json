{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _objectSpread2=_interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _ReanimatedModule=_interopRequireDefault(require(\"../ReanimatedModule\"));var UPDATED_NODES=[];var loopID=1;var propUpdatesEnqueued=null;function sanitizeConfig(config){for(var key in config){var value=config[key];if(value instanceof AnimatedNode){config[key]=value.__nodeID;}}return config;}function runPropUpdates(){var visitedNodes=new Set();var findAndUpdateNodes=function findAndUpdateNodes(node){if(visitedNodes.has(node)){return;}else{visitedNodes.add(node);}if(typeof node.update==='function'){node.update();}else{node.__getChildren().forEach(findAndUpdateNodes);}};for(var i=0;i<UPDATED_NODES.length;i++){var node=UPDATED_NODES[i];findAndUpdateNodes(node);}UPDATED_NODES.length=0;propUpdatesEnqueued=null;loopID+=1;}var nodeCount=0;var AnimatedNode=function(){function AnimatedNode(nodeConfig,inputNodes){(0,_classCallCheck2.default)(this,AnimatedNode);this.__lastLoopID=0;this.__memoizedValue=null;this.__children=[];this.__nodeID=++nodeCount;this.__nodeConfig=sanitizeConfig(nodeConfig);this.__initialized=false;this.__inputNodes=inputNodes&&inputNodes.filter(function(node){return node instanceof AnimatedNode;});}(0,_createClass2.default)(AnimatedNode,[{key:\"__attach\",value:function __attach(){var _this=this;this.__nativeInitialize();this.__inputNodes&&this.__inputNodes.forEach(function(node){return node.__addChild(_this);});}},{key:\"__detach\",value:function __detach(){var _this2=this;this.__inputNodes&&this.__inputNodes.forEach(function(node){return node.__removeChild(_this2);});this.__nativeTearDown();}},{key:\"__getValue\",value:function __getValue(){if(this.__lastLoopID<loopID){this.__lastLoopID=loopID;return this.__memoizedValue=this.__onEvaluate();}return this.__memoizedValue;}},{key:\"__forceUpdateCache\",value:function __forceUpdateCache(newValue){this.__memoizedValue=newValue;this.__markUpdated();}},{key:\"__dangerouslyRescheduleEvaluate\",value:function __dangerouslyRescheduleEvaluate(){this.__lastLoopID=0;this.__markUpdated();}},{key:\"__markUpdated\",value:function __markUpdated(){UPDATED_NODES.push(this);if(!propUpdatesEnqueued){propUpdatesEnqueued=setImmediate(runPropUpdates);}}},{key:\"__nativeInitialize\",value:function __nativeInitialize(){if(!this.__initialized){_ReanimatedModule.default.createNode(this.__nodeID,(0,_objectSpread2.default)({},this.__nodeConfig));this.__initialized=true;}}},{key:\"__nativeTearDown\",value:function __nativeTearDown(){if(this.__initialized){_ReanimatedModule.default.dropNode(this.__nodeID);this.__initialized=false;}}},{key:\"isNativelyInitialized\",value:function isNativelyInitialized(){return this.__initialized;}},{key:\"__onEvaluate\",value:function __onEvaluate(){throw new Error('Missing implementation of onEvaluate');}},{key:\"__getProps\",value:function __getProps(){return this.__getValue();}},{key:\"__getChildren\",value:function __getChildren(){return this.__children;}},{key:\"__addChild\",value:function __addChild(child){if(this.__children.length===0){this.__attach();}this.__children.push(child);child.__nativeInitialize();_ReanimatedModule.default.connectNodes(this.__nodeID,child.__nodeID);}},{key:\"__removeChild\",value:function __removeChild(child){var index=this.__children.indexOf(child);if(index===-1){console.warn(\"Trying to remove a child that doesn't exist\");return;}_ReanimatedModule.default.disconnectNodes(this.__nodeID,child.__nodeID);this.__children.splice(index,1);if(this.__children.length===0){this.__detach();}}},{key:\"_connectAnimatedView\",value:function _connectAnimatedView(nativeViewTag){_ReanimatedModule.default.connectNodeToView(this.__nodeID,nativeViewTag);}},{key:\"_disconnectAnimatedView\",value:function _disconnectAnimatedView(nativeViewTag){_ReanimatedModule.default.disconnectNodeFromView(this.__nodeID,nativeViewTag);}}]);return AnimatedNode;}();exports.default=AnimatedNode;","map":{"version":3,"sources":["/Users/ntareguy/Downloads/gwizamobile1/node_modules/react-native-reanimated/src/core/AnimatedNode.js"],"names":["UPDATED_NODES","loopID","propUpdatesEnqueued","sanitizeConfig","config","key","value","AnimatedNode","__nodeID","runPropUpdates","visitedNodes","Set","findAndUpdateNodes","node","has","add","update","__getChildren","forEach","i","length","nodeCount","nodeConfig","inputNodes","__lastLoopID","__memoizedValue","__children","__nodeConfig","__initialized","__inputNodes","filter","__nativeInitialize","__addChild","__removeChild","__nativeTearDown","__onEvaluate","newValue","__markUpdated","push","setImmediate","ReanimatedModule","createNode","dropNode","Error","__getValue","child","__attach","connectNodes","index","indexOf","console","warn","disconnectNodes","splice","__detach","nativeViewTag","connectNodeToView","disconnectNodeFromView"],"mappings":"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","sourcesContent":["import ReanimatedModule from '../ReanimatedModule';\n\nconst UPDATED_NODES = [];\n\nlet loopID = 1;\nlet propUpdatesEnqueued = null;\n\nfunction sanitizeConfig(config) {\n  for (const key in config) {\n    const value = config[key];\n    if (value instanceof AnimatedNode) {\n      config[key] = value.__nodeID;\n    }\n  }\n  return config;\n}\n\nfunction runPropUpdates() {\n  const visitedNodes = new Set();\n  const findAndUpdateNodes = node => {\n    if (visitedNodes.has(node)) {\n      return;\n    } else {\n      visitedNodes.add(node);\n    }\n    if (typeof node.update === 'function') {\n      node.update();\n    } else {\n      node.__getChildren().forEach(findAndUpdateNodes);\n    }\n  };\n  for (let i = 0; i < UPDATED_NODES.length; i++) {\n    const node = UPDATED_NODES[i];\n    findAndUpdateNodes(node);\n  }\n  UPDATED_NODES.length = 0; // clear array\n  propUpdatesEnqueued = null;\n  loopID += 1;\n}\n\nlet nodeCount = 0;\n\nexport default class AnimatedNode {\n  constructor(nodeConfig, inputNodes) {\n    this.__nodeID = ++nodeCount;\n    this.__nodeConfig = sanitizeConfig(nodeConfig);\n    this.__initialized = false;\n    this.__inputNodes =\n      inputNodes && inputNodes.filter(node => node instanceof AnimatedNode);\n  }\n\n  __attach() {\n    this.__nativeInitialize();\n    this.__inputNodes &&\n      this.__inputNodes.forEach(node => node.__addChild(this));\n  }\n\n  __detach() {\n    this.__inputNodes &&\n      this.__inputNodes.forEach(node => node.__removeChild(this));\n    this.__nativeTearDown();\n  }\n\n  __lastLoopID = 0;\n  __memoizedValue = null;\n\n  __children = [];\n\n  __getValue() {\n    if (this.__lastLoopID < loopID) {\n      this.__lastLoopID = loopID;\n      return (this.__memoizedValue = this.__onEvaluate());\n    }\n    return this.__memoizedValue;\n  }\n\n  __forceUpdateCache(newValue) {\n    this.__memoizedValue = newValue;\n    this.__markUpdated();\n  }\n\n  __dangerouslyRescheduleEvaluate() {\n    this.__lastLoopID = 0;\n    this.__markUpdated();\n  }\n\n  __markUpdated() {\n    UPDATED_NODES.push(this);\n    if (!propUpdatesEnqueued) {\n      propUpdatesEnqueued = setImmediate(runPropUpdates);\n    }\n  }\n\n  __nativeInitialize() {\n    if (!this.__initialized) {\n      ReanimatedModule.createNode(this.__nodeID, { ...this.__nodeConfig });\n      this.__initialized = true;\n    }\n  }\n\n  __nativeTearDown() {\n    if (this.__initialized) {\n      ReanimatedModule.dropNode(this.__nodeID);\n      this.__initialized = false;\n    }\n  }\n\n  isNativelyInitialized() {\n    return this.__initialized;\n  }\n\n  __onEvaluate() {\n    throw new Error('Missing implementation of onEvaluate');\n  }\n\n  __getProps() {\n    return this.__getValue();\n  }\n\n  __getChildren() {\n    return this.__children;\n  }\n\n  __addChild(child) {\n    if (this.__children.length === 0) {\n      this.__attach();\n    }\n    this.__children.push(child);\n    child.__nativeInitialize();\n\n    ReanimatedModule.connectNodes(this.__nodeID, child.__nodeID);\n  }\n\n  __removeChild(child) {\n    const index = this.__children.indexOf(child);\n    if (index === -1) {\n      console.warn(\"Trying to remove a child that doesn't exist\");\n      return;\n    }\n    ReanimatedModule.disconnectNodes(this.__nodeID, child.__nodeID);\n\n    this.__children.splice(index, 1);\n    if (this.__children.length === 0) {\n      this.__detach();\n    }\n  }\n\n  _connectAnimatedView(nativeViewTag) {\n    ReanimatedModule.connectNodeToView(this.__nodeID, nativeViewTag);\n  }\n\n  _disconnectAnimatedView(nativeViewTag) {\n    ReanimatedModule.disconnectNodeFromView(this.__nodeID, nativeViewTag);\n  }\n}\n"]},"metadata":{},"sourceType":"script"}