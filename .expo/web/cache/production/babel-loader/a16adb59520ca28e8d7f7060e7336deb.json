{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _possibleConstructorReturn2=_interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));var _getPrototypeOf2=_interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));var _inherits2=_interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));var _reactNative=require(\"react-native\");var _ReanimatedModule=_interopRequireDefault(require(\"../ReanimatedModule\"));var _AnimatedNode2=_interopRequireDefault(require(\"./AnimatedNode\"));var _AnimatedValue=_interopRequireDefault(require(\"./AnimatedValue\"));var _AnimatedAlways=_interopRequireDefault(require(\"./AnimatedAlways\"));var _invariant=_interopRequireDefault(require(\"fbjs/lib/invariant\"));var _createEventObjectProxyPolyfill=_interopRequireDefault(require(\"./createEventObjectProxyPolyfill\"));function sanitizeArgMapping(argMapping){var eventMappings=[];var alwaysNodes=[];var traverse=function traverse(value,path){if(value instanceof _AnimatedValue.default){eventMappings.push(path.concat(value.__nodeID));}else if(typeof value==='object'&&value.__val){eventMappings.push(path.concat(value.__val.__nodeID));}else if(typeof value==='function'){var node=new _AnimatedValue.default(0);alwaysNodes.push(new _AnimatedAlways.default(value(node)));eventMappings.push(path.concat(node.__nodeID));}else if(typeof value==='object'){for(var key in value){traverse(value[key],path.concat(key));}}};(0,_invariant.default)(argMapping[0]&&argMapping[0].nativeEvent,'Native driven events only support animated values contained inside `nativeEvent`.');var ev=argMapping[0].nativeEvent;if(typeof ev==='object'){traverse(ev,[]);}else if(typeof ev==='function'){var proxyHandler={get:function get(target,name){if(name==='__isProxy'){return true;}if(!target[name]&&name!=='__val'){target[name]=new Proxy({},proxyHandler);}return target[name];},set:function set(target,prop,value){if(prop==='__val'){target[prop]=value;}}};var proxy=_reactNative.Platform.OS==='android'?(0,_createEventObjectProxyPolyfill.default)():new Proxy({},proxyHandler);alwaysNodes.push(new _AnimatedAlways.default(ev(proxy)));traverse(proxy,[]);}return{eventMappings:eventMappings,alwaysNodes:alwaysNodes};}var AnimatedEvent=function(_AnimatedNode){(0,_inherits2.default)(AnimatedEvent,_AnimatedNode);function AnimatedEvent(argMapping){var _this;var config=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};(0,_classCallCheck2.default)(this,AnimatedEvent);var _sanitizeArgMapping=sanitizeArgMapping(argMapping),eventMappings=_sanitizeArgMapping.eventMappings,alwaysNodes=_sanitizeArgMapping.alwaysNodes;_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(AnimatedEvent).call(this,{type:'event',argMapping:eventMappings}));_this.__isNative=true;_this._alwaysNodes=alwaysNodes;return _this;}(0,_createClass2.default)(AnimatedEvent,[{key:\"attachEvent\",value:function attachEvent(viewRef,eventName){for(var i=0;i<this._alwaysNodes.length;i++){this._alwaysNodes[i].__attach();}this.__attach();var viewTag=(0,_reactNative.findNodeHandle)(viewRef);_ReanimatedModule.default.attachEvent(viewTag,eventName,this.__nodeID);}},{key:\"detachEvent\",value:function detachEvent(viewRef,eventName){for(var i=0;i<this._alwaysNodes.length;i++){this._alwaysNodes[i].isNativelyInitialized()&&this._alwaysNodes[i].__detach();}var viewTag=(0,_reactNative.findNodeHandle)(viewRef);_ReanimatedModule.default.detachEvent(viewTag,eventName,this.__nodeID);this.__detach();}}]);return AnimatedEvent;}(_AnimatedNode2.default);exports.default=AnimatedEvent;","map":{"version":3,"sources":["/Users/ntareguy/Downloads/gwizamobile1/node_modules/react-native-reanimated/src/core/AnimatedEvent.js"],"names":["sanitizeArgMapping","argMapping","eventMappings","alwaysNodes","traverse","value","path","AnimatedValue","push","concat","__nodeID","__val","node","AnimatedAlways","key","nativeEvent","ev","proxyHandler","get","target","name","Proxy","set","prop","proxy","Platform","OS","AnimatedEvent","config","type","__isNative","_alwaysNodes","viewRef","eventName","i","length","__attach","viewTag","ReanimatedModule","attachEvent","isNativelyInitialized","__detach","detachEvent","AnimatedNode"],"mappings":"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","sourcesContent":["import { findNodeHandle, Platform } from 'react-native';\nimport ReanimatedModule from '../ReanimatedModule';\n\nimport AnimatedNode from './AnimatedNode';\nimport AnimatedValue from './AnimatedValue';\nimport AnimatedAlways from './AnimatedAlways';\n\nimport invariant from 'fbjs/lib/invariant';\nimport createEventObjectProxyPolyfill from './createEventObjectProxyPolyfill';\n\nfunction sanitizeArgMapping(argMapping) {\n  // Find animated values in `argMapping` and create an array representing their\n  // key path inside the `nativeEvent` object. Ex.: ['contentOffset', 'x'].\n  const eventMappings = [];\n  const alwaysNodes = [];\n\n  const traverse = (value, path) => {\n    if (value instanceof AnimatedValue) {\n      eventMappings.push(path.concat(value.__nodeID));\n    } else if (typeof value === 'object' && value.__val) {\n      eventMappings.push(path.concat(value.__val.__nodeID));\n    } else if (typeof value === 'function') {\n      const node = new AnimatedValue(0);\n      alwaysNodes.push(new AnimatedAlways(value(node)));\n      eventMappings.push(path.concat(node.__nodeID));\n    } else if (typeof value === 'object') {\n      for (const key in value) {\n        traverse(value[key], path.concat(key));\n      }\n    }\n  };\n\n  invariant(\n    argMapping[0] && argMapping[0].nativeEvent,\n    'Native driven events only support animated values contained inside `nativeEvent`.'\n  );\n\n  // Assume that the event containing `nativeEvent` is always the first argument.\n  const ev = argMapping[0].nativeEvent;\n  if (typeof ev === 'object') {\n    traverse(ev, []);\n  } else if (typeof ev === 'function') {\n    const proxyHandler = {\n      get: function(target, name) {\n        if (name === '__isProxy') {\n          return true;\n        }\n        if (!target[name] && name !== '__val') {\n          target[name] = new Proxy({}, proxyHandler);\n        }\n        return target[name];\n      },\n      set: function(target, prop, value) {\n        if (prop === '__val') {\n          target[prop] = value;\n        }\n      },\n    };\n\n    const proxy =\n      Platform.OS === 'android'\n        ? createEventObjectProxyPolyfill()\n        : new Proxy({}, proxyHandler);\n    alwaysNodes.push(new AnimatedAlways(ev(proxy)));\n    traverse(proxy, []);\n  }\n\n  return { eventMappings, alwaysNodes };\n}\n\nexport default class AnimatedEvent extends AnimatedNode {\n  constructor(argMapping, config = {}) {\n    const { eventMappings, alwaysNodes } = sanitizeArgMapping(argMapping);\n    super({ type: 'event', argMapping: eventMappings });\n    this._alwaysNodes = alwaysNodes;\n  }\n\n  // The below field is a temporary workaround to make AnimatedEvent object be recognized\n  // as Animated.event event callback and therefore filtered out from being send over the\n  // bridge which was causing the object to be frozen in JS.\n  __isNative = true;\n\n  attachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].__attach();\n    }\n    this.__attach();\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.attachEvent(viewTag, eventName, this.__nodeID);\n  }\n\n  detachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].isNativelyInitialized() &&\n        this._alwaysNodes[i].__detach();\n    }\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.detachEvent(viewTag, eventName, this.__nodeID);\n    this.__detach();\n  }\n}\n"]},"metadata":{},"sourceType":"script"}