{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.reload=reload;exports.reloadFromCache=reloadFromCache;exports.checkForUpdateAsync=checkForUpdateAsync;exports.fetchUpdateAsync=fetchUpdateAsync;exports.addListener=addListener;exports.EventType=void 0;var _regenerator=_interopRequireDefault(require(\"@babel/runtime/regenerator\"));var _fbemitter=require(\"fbemitter\");var _reactNative=require(\"react-native\");var ExponentUpdates=_reactNative.NativeModules.ExponentUpdates;function reload(){ExponentUpdates.reload();}function reloadFromCache(){ExponentUpdates.reloadFromCache();}function checkForUpdateAsync(){var result,returnObj;return _regenerator.default.async(function checkForUpdateAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regenerator.default.awrap(ExponentUpdates.checkForUpdateAsync());case 2:result=_context.sent;returnObj={isAvailable:!!result};if(result){returnObj.manifest=typeof result==='string'?JSON.parse(result):result;}return _context.abrupt(\"return\",returnObj);case 6:case\"end\":return _context.stop();}}},null,this);}function fetchUpdateAsync(){var _ref,eventListener,subscription,result,returnObj,_args2=arguments;return _regenerator.default.async(function fetchUpdateAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_ref=_args2.length>0&&_args2[0]!==undefined?_args2[0]:{},eventListener=_ref.eventListener;if(eventListener&&typeof eventListener==='function'){subscription=addListener(eventListener);}_context2.prev=2;_context2.next=5;return _regenerator.default.awrap(ExponentUpdates.fetchUpdateAsync());case 5:result=_context2.sent;case 6:_context2.prev=6;subscription&&subscription.remove();return _context2.finish(6);case 9:returnObj={isNew:!!result};if(result){returnObj.manifest=typeof result==='string'?JSON.parse(result):result;}return _context2.abrupt(\"return\",returnObj);case 12:case\"end\":return _context2.stop();}}},null,this,[[2,,6,9]]);}var _emitter;function _getEmitter(){if(!_emitter){_emitter=new _fbemitter.EventEmitter();_reactNative.DeviceEventEmitter.addListener('Exponent.nativeUpdatesEvent',_emitEvent);}return _emitter;}function _emitEvent(params){var newParams=params;if(typeof params==='string'){newParams=JSON.parse(params);}if(newParams.manifestString){newParams.manifest=JSON.parse(newParams.manifestString);delete newParams.manifestString;}if(!_emitter){throw new Error(\"EventEmitter must be initialized to use from its listener\");}_emitter.emit('Exponent.updatesEvent',newParams);}function addListener(listener){var emitter=_getEmitter();return emitter.addListener('Exponent.updatesEvent',listener);}var EventType={DOWNLOAD_STARTED:'downloadStart',DOWNLOAD_PROGRESS:'downloadProgress',DOWNLOAD_FINISHED:'downloadFinished',NO_UPDATE_AVAILABLE:'noUpdateAvailable',ERROR:'error'};exports.EventType=EventType;","map":{"version":3,"sources":["../src/Updates.ts"],"names":[],"mappings":"4aAAA,oCACA,yC,GAEQ,CAAA,e,CAAoB,0B,CAApB,e,CAEF,QAAU,CAAA,MAAV,EAAgB,CACpB,eAAe,CAAC,MAAhB,GACD,CAEK,QAAU,CAAA,eAAV,EAAyB,CAC7B,eAAe,CAAC,eAAhB,GACD,CAEM,QAAe,CAAA,mBAAf,wMACgB,eAAe,CAAC,mBAAhB,EADhB,SACC,MADD,eAED,SAFC,CAEgB,CACnB,WAAW,CAAE,CAAC,CAAC,MADI,CAFhB,CAKL,GAAI,MAAJ,CAAY,CACV,SAAS,CAAC,QAAV,CAAqB,MAAO,CAAA,MAAP,GAAkB,QAAlB,CAA6B,IAAI,CAAC,KAAL,CAAW,MAAX,CAA7B,CAAkD,MAAvE,CACD,CAPI,gCAQE,SARF,0DAWA,QAAe,CAAA,gBAAf,6PAAyD,EAAzD,CAAkC,aAAlC,MAAkC,aAAlC,CAGL,GAAI,aAAa,EAAI,MAAO,CAAA,aAAP,GAAyB,UAA9C,CAA0D,CACxD,YAAY,CAAG,WAAW,CAAC,aAAD,CAA1B,CACD,CALI,oEAOY,eAAe,CAAC,gBAAhB,EAPZ,SAOH,MAPG,wCASH,YAAY,EAAI,YAAY,CAAC,MAAb,EAAhB,CATG,kCAWD,SAXC,CAWgB,CACnB,KAAK,CAAE,CAAC,CAAC,MADU,CAXhB,CAcL,GAAI,MAAJ,CAAY,CACV,SAAS,CAAC,QAAV,CAAqB,MAAO,CAAA,MAAP,GAAkB,QAAlB,CAA6B,IAAI,CAAC,KAAL,CAAW,MAAX,CAA7B,CAAkD,MAAvE,CACD,CAhBI,iCAiBE,SAjBF,uEAoBP,GAAI,CAAA,QAAJ,CAEA,QAAS,CAAA,WAAT,EAAoB,CAClB,GAAI,CAAC,QAAL,CAAe,CACb,QAAQ,CAAG,GAAI,wBAAJ,EAAX,CACA,gCAAmB,WAAnB,CAA+B,6BAA/B,CAA8D,UAA9D,EACD,CACD,MAAO,CAAA,QAAP,CACD,CAED,QAAS,CAAA,UAAT,CAAoB,MAApB,CAA0B,CACxB,GAAI,CAAA,SAAS,CAAG,MAAhB,CACA,GAAI,MAAO,CAAA,MAAP,GAAkB,QAAtB,CAAgC,CAC9B,SAAS,CAAG,IAAI,CAAC,KAAL,CAAW,MAAX,CAAZ,CACD,CACD,GAAI,SAAS,CAAC,cAAd,CAA8B,CAC5B,SAAS,CAAC,QAAV,CAAqB,IAAI,CAAC,KAAL,CAAW,SAAS,CAAC,cAArB,CAArB,CACA,MAAO,CAAA,SAAS,CAAC,cAAjB,CACD,CAED,GAAI,CAAC,QAAL,CAAe,CACb,KAAM,IAAI,CAAA,KAAJ,6DAAN,CACD,CACD,QAAQ,CAAC,IAAT,CAAc,uBAAd,CAAuC,SAAvC,EACD,CAEK,QAAU,CAAA,WAAV,CAAsB,QAAtB,CAAwC,CAC5C,GAAI,CAAA,OAAO,CAAG,WAAW,EAAzB,CACA,MAAO,CAAA,OAAO,CAAC,WAAR,CAAoB,uBAApB,CAA6C,QAA7C,CAAP,CACD,CAEM,GAAM,CAAA,SAAS,CAAG,CACvB,gBAAgB,CAAE,eADK,CAEvB,iBAAiB,CAAE,kBAFI,CAGvB,iBAAiB,CAAE,kBAHI,CAIvB,mBAAmB,CAAE,mBAJE,CAKvB,KAAK,CAAE,OALgB,CAAlB,C","sourcesContent":["import { EventEmitter, EventSubscription } from 'fbemitter';\nimport { DeviceEventEmitter, NativeModules } from 'react-native';\n\nconst { ExponentUpdates } = NativeModules;\n\nexport function reload(): void {\n  ExponentUpdates.reload();\n}\n\nexport function reloadFromCache(): void {\n  ExponentUpdates.reloadFromCache();\n}\n\nexport async function checkForUpdateAsync(): Promise<Object> {\n  const result = await ExponentUpdates.checkForUpdateAsync();\n  let returnObj: any = {\n    isAvailable: !!result,\n  };\n  if (result) {\n    returnObj.manifest = typeof result === 'string' ? JSON.parse(result) : result;\n  }\n  return returnObj;\n}\n\nexport async function fetchUpdateAsync({ eventListener }: any = {}): Promise<Object> {\n  let subscription;\n  let result;\n  if (eventListener && typeof eventListener === 'function') {\n    subscription = addListener(eventListener);\n  }\n  try {\n    result = await ExponentUpdates.fetchUpdateAsync();\n  } finally {\n    subscription && subscription.remove();\n  }\n  let returnObj: any = {\n    isNew: !!result,\n  };\n  if (result) {\n    returnObj.manifest = typeof result === 'string' ? JSON.parse(result) : result;\n  }\n  return returnObj;\n}\n\nlet _emitter: EventEmitter | null;\n\nfunction _getEmitter(): EventEmitter {\n  if (!_emitter) {\n    _emitter = new EventEmitter();\n    DeviceEventEmitter.addListener('Exponent.nativeUpdatesEvent', _emitEvent);\n  }\n  return _emitter;\n}\n\nfunction _emitEvent(params): void {\n  let newParams = params;\n  if (typeof params === 'string') {\n    newParams = JSON.parse(params);\n  }\n  if (newParams.manifestString) {\n    newParams.manifest = JSON.parse(newParams.manifestString);\n    delete newParams.manifestString;\n  }\n\n  if (!_emitter) {\n    throw new Error(`EventEmitter must be initialized to use from its listener`);\n  }\n  _emitter.emit('Exponent.updatesEvent', newParams);\n}\n\nexport function addListener(listener: Function): EventSubscription {\n  let emitter = _getEmitter();\n  return emitter.addListener('Exponent.updatesEvent', listener);\n}\n\nexport const EventType = {\n  DOWNLOAD_STARTED: 'downloadStart',\n  DOWNLOAD_PROGRESS: 'downloadProgress',\n  DOWNLOAD_FINISHED: 'downloadFinished',\n  NO_UPDATE_AVAILABLE: 'noUpdateAvailable',\n  ERROR: 'error',\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}